<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Personal Notes Dashboard</title>
  <link href="https://cdnjs.cloudflare.com/ajax/libs/tailwindcss/2.2.19/tailwind.min.css" rel="stylesheet">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.29.1/moment.min.js"></script>
  <style>
    .note-card {
      transition: all 0.3s ease;
    }
    .note-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
    }
    #clock {
      font-family: 'Courier New', monospace;
    }
  </style>
</head>
<body class="bg-gray-100 min-h-screen">
  <div class="container mx-auto p-4">
    <!-- Header -->
    <header class="bg-blue-600 text-white rounded-lg shadow-lg p-6 mb-8">
      <div class="flex flex-col md:flex-row justify-between items-center">
        <div>
          <h1 class="text-3xl font-bold">Personal Notes Dashboard</h1>
          <p class="text-blue-100">Kelola catatan pribadi Anda</p>
        </div>
        <div class="mt-4 md:mt-0 text-right">
          <div id="clock" class="text-2xl font-bold"></div>
          <div id="date" class="text-sm"></div>
        </div>
      </div>
    </header>

    <!-- Main Content -->
    <main class="flex flex-col md:flex-row gap-6">
      <!-- Form Section -->
      <section class="w-full md:w-1/3 bg-white rounded-lg shadow-md p-6">
        <h2 class="text-xl font-semibold mb-4 text-gray-700">Tambah Catatan Baru</h2>
        <form id="note-form" class="space-y-4">
          <input type="hidden" id="note-id">
          <div>
            <label for="note-title" class="block text-sm font-medium text-gray-700">Judul</label>
            <input type="text" id="note-title" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2 border" placeholder="Judul catatan..." required>
          </div>
          <div>
            <label for="note-category" class="block text-sm font-medium text-gray-700">Kategori</label>
            <select id="note-category" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2 border">
              <option value="personal">Personal</option>
              <option value="work">Pekerjaan</option>
              <option value="study">Pembelajaran</option>
              <option value="idea">Ide</option>
            </select>
          </div>
          <div>
            <label for="note-content" class="block text-sm font-medium text-gray-700">Isi Catatan</label>
            <textarea id="note-content" rows="4" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2 border" placeholder="Isi catatan Anda di sini..." required></textarea>
          </div>
          <div class="flex space-x-2">
            <button type="submit" id="save-btn" class="bg-blue-600 hover:bg-blue-700 text-white font-medium py-2 px-4 rounded-md transition">Simpan</button>
            <button type="button" id="reset-btn" class="bg-gray-500 hover:bg-gray-600 text-white font-medium py-2 px-4 rounded-md transition">Reset</button>
          </div>
        </form>
      </section>

      <!-- Notes List Section -->
      <section class="w-full md:w-2/3">
        <div class="bg-white rounded-lg shadow-md p-6 mb-6">
          <div class="flex justify-between items-center mb-4">
            <h2 class="text-xl font-semibold text-gray-700">Catatan Saya</h2>
            <div class="flex space-x-2">
              <select id="filter-category" class="rounded-md border-gray-300 shadow-sm p-2 text-sm border">
                <option value="all">Semua Kategori</option>
                <option value="personal">Personal</option>
                <option value="work">Pekerjaan</option>
                <option value="study">Pembelajaran</option>
                <option value="idea">Ide</option>
              </select>
              <input type="text" id="search-notes" placeholder="Cari catatan..." class="rounded-md border-gray-300 shadow-sm p-2 text-sm border">
            </div>
          </div>
          
          <div id="notes-container" class="grid grid-cols-1 md:grid-cols-2 gap-4">
            <!-- Notes will be inserted here -->
          </div>
          
          <div id="no-notes" class="text-center p-8 text-gray-500 hidden">
            <p>Belum ada catatan. Tambahkan catatan baru!</p>
          </div>
        </div>
        
        <!-- Summary Section -->
        <div class="bg-white rounded-lg shadow-md p-6">
          <h2 class="text-xl font-semibold mb-4 text-gray-700">Ringkasan</h2>
          <div class="grid grid-cols-2 md:grid-cols-4 gap-4 text-center">
            <div class="bg-blue-100 p-4 rounded-lg">
              <p class="text-sm text-blue-600">Total Catatan</p>
              <p id="total-notes" class="text-2xl font-bold text-blue-800">0</p>
            </div>
            <div class="bg-green-100 p-4 rounded-lg">
              <p class="text-sm text-green-600">Personal</p>
              <p id="personal-count" class="text-2xl font-bold text-green-800">0</p>
            </div>
            <div class="bg-yellow-100 p-4 rounded-lg">
              <p class="text-sm text-yellow-600">Pekerjaan</p>
              <p id="work-count" class="text-2xl font-bold text-yellow-800">0</p>
            </div>
            <div class="bg-purple-100 p-4 rounded-lg">
              <p class="text-sm text-purple-600">Pembelajaran</p>
              <p id="study-count" class="text-2xl font-bold text-purple-800">0</p>
            </div>
          </div>
        </div>
      </section>
    </main>
  </div>

  <!-- Confirmation Modal -->
  <div id="confirm-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center hidden z-50">
    <div class="bg-white rounded-lg p-6 max-w-md w-full">
      <h3 class="text-lg font-semibold mb-4">Konfirmasi</h3>
      <p id="confirm-message">Apakah Anda yakin ingin menghapus catatan ini?</p>
      <div class="flex justify-end mt-6 space-x-2">
        <button id="cancel-delete" class="bg-gray-400 hover:bg-gray-500 text-white px-4 py-2 rounded">Batal</button>
        <button id="confirm-delete" class="bg-red-600 hover:bg-red-700 text-white px-4 py-2 rounded">Hapus</button>
      </div>
    </div>
  </div>

  <script type="module">
    // Note class - Implementing ES6 Classes
    class Note {
      constructor(id, title, content, category, createdAt = new Date()) {
        this.id = id;
        this.title = title;
        this.content = content;
        this.category = category;
        this.createdAt = createdAt;
      }

      // Method to format date
      formatDate() {
        return moment(this.createdAt).format('DD MMM YYYY, HH:mm');
      }

      // Method to get category badge color
      getCategoryColor() {
        const colors = {
          personal: 'bg-green-100 text-green-800',
          work: 'bg-yellow-100 text-yellow-800',
          study: 'bg-purple-100 text-purple-800',
          idea: 'bg-blue-100 text-blue-800'
        };
        return colors[this.category] || 'bg-gray-100 text-gray-800';
      }

      // Method to get category display name
      getCategoryName() {
        const names = {
          personal: 'Personal',
          work: 'Pekerjaan',
          study: 'Pembelajaran',
          idea: 'Ide'
        };
        return names[this.category] || this.category;
      }
    }

    // NotesManager class to handle notes operations
    class NotesManager {
      constructor() {
        this.notes = [];
        this.loadFromLocalStorage();
      }

      // Load notes from localStorage
      loadFromLocalStorage() {
        try {
          const storedNotes = JSON.parse(localStorage.getItem('notes')) || [];
          this.notes = storedNotes.map(note => new Note(
            note.id,
            note.title,
            note.content,
            note.category,
            new Date(note.createdAt)
          ));
        } catch (error) {
          console.error('Error loading notes:', error);
          this.notes = [];
        }
      }

      // Save notes to localStorage
      saveToLocalStorage() {
        localStorage.setItem('notes', JSON.stringify(this.notes));
      }

      // Add a new note
      addNote(title, content, category) {
        const id = Date.now().toString();
        const newNote = new Note(id, title, content, category);
        this.notes.push(newNote);
        this.saveToLocalStorage();
        return newNote;
      }

      // Update existing note
      updateNote(id, title, content, category) {
        const index = this.notes.findIndex(note => note.id === id);
        if (index !== -1) {
          this.notes[index].title = title;
          this.notes[index].content = content;
          this.notes[index].category = category;
          this.saveToLocalStorage();
          return true;
        }
        return false;
      }

      // Delete a note
      deleteNote(id) {
        this.notes = this.notes.filter(note => note.id !== id);
        this.saveToLocalStorage();
      }

      // Get a note by ID
      getNote(id) {
        return this.notes.find(note => note.id === id);
      }

      // Get all notes
      getAllNotes() {
        return [...this.notes].sort((a, b) => new Date(b.createdAt) - new Date(a.createdAt));
      }

      // Filter notes by category
      filterByCategory(category) {
        if (category === 'all') {
          return this.getAllNotes();
        }
        return this.notes
          .filter(note => note.category === category)
          .sort((a, b) => new Date(b.createdAt) - new Date(a.createdAt));
      }

      // Search notes by title or content
      searchNotes(query) {
        if (!query) return this.getAllNotes();
        
        const lowerQuery = query.toLowerCase();
        return this.notes
          .filter(note => 
            note.title.toLowerCase().includes(lowerQuery) || 
            note.content.toLowerCase().includes(lowerQuery)
          )
          .sort((a, b) => new Date(b.createdAt) - new Date(a.createdAt));
      }

      // Get category counts
      getCategoryCounts() {
        const counts = {
          total: this.notes.length,
          personal: 0,
          work: 0,
          study: 0,
          idea: 0
        };

        this.notes.forEach(note => {
          if (counts[note.category] !== undefined) {
            counts[note.category]++;
          }
        });

        return counts;
      }
    }

    // UI Controller
    const UI = {
      // DOM Elements
      elements: {
        noteForm: document.getElementById('note-form'),
        noteId: document.getElementById('note-id'),
        noteTitle: document.getElementById('note-title'),
        noteContent: document.getElementById('note-content'),
        noteCategory: document.getElementById('note-category'),
        saveBtn: document.getElementById('save-btn'),
        resetBtn: document.getElementById('reset-btn'),
        notesContainer: document.getElementById('notes-container'),
        noNotes: document.getElementById('no-notes'),
        filterCategory: document.getElementById('filter-category'),
        searchNotes: document.getElementById('search-notes'),
        confirmModal: document.getElementById('confirm-modal'),
        confirmDelete: document.getElementById('confirm-delete'),
        cancelDelete: document.getElementById('cancel-delete'),
        clock: document.getElementById('clock'),
        date: document.getElementById('date'),
        totalNotes: document.getElementById('total-notes'),
        personalCount: document.getElementById('personal-count'),
        workCount: document.getElementById('work-count'),
        studyCount: document.getElementById('study-count')
      },

      // Initialize UI
      init() {
        this.updateClock();
        setInterval(() => this.updateClock(), 1000);
        this.setupEventListeners();
      },

      // Setup event listeners
      setupEventListeners() {
        // Form submission
        this.elements.noteForm.addEventListener('submit', e => {
          e.preventDefault();
          this.handleFormSubmit();
        });

        // Reset button
        this.elements.resetBtn.addEventListener('click', () => {
          this.resetForm();
        });

        // Filter change
        this.elements.filterCategory.addEventListener('change', () => {
          this.renderNotes();
        });

        // Search input
        this.elements.searchNotes.addEventListener('input', () => {
          this.renderNotes();
        });

        // Cancel delete
        this.elements.cancelDelete.addEventListener('click', () => {
          this.closeModal();
        });
      },

      // Handle form submission
      handleFormSubmit() {
        const id = this.elements.noteId.value;
        const title = this.elements.noteTitle.value;
        const content = this.elements.noteContent.value;
        const category = this.elements.noteCategory.value;

        if (!title || !content) return;

        if (id) {
          // Update existing note
          notesManager.updateNote(id, title, content, category);
        } else {
          // Add new note
          notesManager.addNote(title, content, category);
        }

        this.resetForm();
        this.renderNotes();
        this.updateStats();
      },

      // Reset form
      resetForm() {
        this.elements.noteId.value = '';
        this.elements.noteTitle.value = '';
        this.elements.noteContent.value = '';
        this.elements.noteCategory.value = 'personal';
        this.elements.saveBtn.textContent = 'Simpan';
      },

      // Load note to form for editing
      loadNoteToForm(note) {
        this.elements.noteId.value = note.id;
        this.elements.noteTitle.value = note.title;
        this.elements.noteContent.value = note.content;
        this.elements.noteCategory.value = note.category;
        this.elements.saveBtn.textContent = 'Update';
        
        // Scroll to form
        this.elements.noteForm.scrollIntoView({ behavior: 'smooth' });
      },

      // Show delete confirmation modal
      showDeleteModal(id) {
        this.elements.confirmModal.classList.remove('hidden');
        
        // Setup confirm button
        this.elements.confirmDelete.onclick = () => {
          notesManager.deleteNote(id);
          this.closeModal();
          this.renderNotes();
          this.updateStats();
        };
      },

      // Close modal
      closeModal() {
        this.elements.confirmModal.classList.add('hidden');
      },

      // Create note card element
      createNoteCard(note) {
        const categoryClass = note.getCategoryColor();
        
        const noteCard = document.createElement('div');
        noteCard.className = 'note-card bg-white border rounded-lg shadow-sm hover:shadow-md transition-shadow p-4';
        noteCard.innerHTML = `
          <div class="flex justify-between items-start mb-2">
            <h3 class="font-semibold text-lg text-gray-800">${this.escapeHTML(note.title)}</h3>
            <span class="${categoryClass} text-xs px-2 py-1 rounded-full">${note.getCategoryName()}</span>
          </div>
          <p class="text-gray-600 mb-3 whitespace-pre-line">${this.truncateText(this.escapeHTML(note.content), 100)}</p>
          <div class="flex justify-between items-center text-sm text-gray-500">
            <span>${note.formatDate()}</span>
            <div class="flex space-x-2">
              <button class="edit-btn text-blue-600 hover:text-blue-800">Edit</button>
              <button class="delete-btn text-red-600 hover:text-red-800">Hapus</button>
            </div>
          </div>
        `;

        // Add event listeners
        noteCard.querySelector('.edit-btn').addEventListener('click', () => {
          this.loadNoteToForm(note);
        });

        noteCard.querySelector('.delete-btn').addEventListener('click', () => {
          this.showDeleteModal(note.id);
        });

        return noteCard;
      },

      // Render notes based on filters
      renderNotes() {
        const category = this.elements.filterCategory.value;
        const searchQuery = this.elements.searchNotes.value;
        
        let filteredNotes;
        
        // Apply filters
        if (searchQuery) {
          filteredNotes = notesManager.searchNotes(searchQuery);
          if (category !== 'all') {
            filteredNotes = filteredNotes.filter(note => note.category === category);
          }
        } else {
          filteredNotes = notesManager.filterByCategory(category);
        }

        // Clear container
        this.elements.notesContainer.innerHTML = '';
        
        // Show or hide "no notes" message
        if (filteredNotes.length === 0) {
          this.elements.noNotes.classList.remove('hidden');
        } else {
          this.elements.noNotes.classList.add('hidden');
          
          // Add notes to container
          filteredNotes.forEach(note => {
            this.elements.notesContainer.appendChild(this.createNoteCard(note));
          });
        }
      },

      // Update stats
      updateStats() {
        const counts = notesManager.getCategoryCounts();
        this.elements.totalNotes.textContent = counts.total;
        this.elements.personalCount.textContent = counts.personal;
        this.elements.workCount.textContent = counts.work;
        this.elements.studyCount.textContent = counts.study;
      },

      // Update clock
      updateClock() {
        const now = new Date();
        this.elements.clock.textContent = now.toLocaleTimeString();
        this.elements.date.textContent = now.toLocaleDateString('id-ID', { 
          weekday: 'long', 
          year: 'numeric', 
          month: 'long', 
          day: 'numeric' 
        });
      },

      // Helper: Truncate text
      truncateText(text, maxLength) {
        if (text.length <= maxLength) return text;
        return `${text.substring(0, maxLength)}...`;
      },

      // Helper: Escape HTML to prevent XSS
      escapeHTML(str) {
        const div = document.createElement('div');
        div.textContent = str;
        return div.innerHTML;
      }
    };

    // Initialize
    const notesManager = new NotesManager();
    
    // DOM content loaded
    document.addEventListener('DOMContentLoaded', () => {
      UI.init();
      UI.renderNotes();
      UI.updateStats();
    });
  </script>
</body>
</html>